$(document).ready(function(){
	var data_cfh={"ask":{"query":{"q":"[[CFH]]","po":["is_associated_with_disease"]},"results":{"count":1,"items":[{"properties":{"is_associated_with_disease":["Myocardial infarction","Membranoproliferative glomerulonephritis","Thrombocytopenia","Age related macular degeneration","Kidney failure","Hemolytic-uremic syndrome"],"type":{"mTextform":"Human proteins","mUrlform":"Human_proteins","mDbkeyform":"Human_proteins","mUserCaseDBKey":"Human_proteins","mNamespace":14,"mInterwiki":"","mFragment":"","mArticleID":-1,"mLatestID":false,"mRestrictions":[],"mOldRestrictions":false,"mCascadeRestriction":null,"mCascadingRestrictions":null,"mRestrictionsExpiry":[],"mHasCascadingRestrictions":null,"mCascadeSources":null,"mRestrictionsLoaded":false,"mPrefixedText":"Category:Human proteins","mTitleProtection":null,"mDefaultNamespace":0,"mWatched":null,"mLength":-1,"mRedirect":null,"mNotificationTimestamp":[],"mBacklinkCache":null}},"title":{"mTextform":"Factor H","mUrlform":"Factor_H","mDbkeyform":"Factor_H","mUserCaseDBKey":"Factor_H","mNamespace":0,"mInterwiki":"","mFragment":"","mArticleID":-1,"mLatestID":false,"mRestrictions":[],"mOldRestrictions":false,"mCascadeRestriction":null,"mCascadingRestrictions":null,"mRestrictionsExpiry":[],"mHasCascadingRestrictions":null,"mCascadeSources":null,"mRestrictionsLoaded":false,"mPrefixedText":null,"mTitleProtection":null,"mDefaultNamespace":0,"mWatched":null,"mLength":-1,"mRedirect":null,"mNotificationTimestamp":[],"mBacklinkCache":null},"uri":"http:\/\/genewikiplus.org\/index.php?title=Factor H"}]},"result":"Success"}};
	var data_pin1={"ask":{"query":{"q":"[[In_gene::PIN1]]","po":["?is associated with disease"]},"results":{"count":3,"items":[{"properties":{"is_associated_with_disease":"Breast cancer","type":{"mTextform":"Is a snp","mUrlform":"Is_a_snp","mDbkeyform":"Is_a_snp","mUserCaseDBKey":"Is_a_snp","mNamespace":14,"mInterwiki":"","mFragment":"","mArticleID":-1,"mLatestID":false,"mRestrictions":[],"mOldRestrictions":false,"mCascadeRestriction":null,"mCascadingRestrictions":null,"mRestrictionsExpiry":[],"mHasCascadingRestrictions":null,"mCascadeSources":null,"mRestrictionsLoaded":false,"mPrefixedText":"Category:Is a snp","mTitleProtection":null,"mDefaultNamespace":0,"mWatched":null,"mLength":-1,"mRedirect":null,"mNotificationTimestamp":[],"mBacklinkCache":null}},"title":{"mTextform":"Rs2233678","mUrlform":"Rs2233678","mDbkeyform":"Rs2233678","mUserCaseDBKey":"Rs2233678","mNamespace":0,"mInterwiki":"","mFragment":"","mArticleID":-1,"mLatestID":false,"mRestrictions":[],"mOldRestrictions":false,"mCascadeRestriction":null,"mCascadingRestrictions":null,"mRestrictionsExpiry":[],"mHasCascadingRestrictions":null,"mCascadeSources":null,"mRestrictionsLoaded":false,"mPrefixedText":null,"mTitleProtection":null,"mDefaultNamespace":0,"mWatched":null,"mLength":-1,"mRedirect":null,"mNotificationTimestamp":[],"mBacklinkCache":null},"uri":"http:\/\/genewikiplus.org\/index.php?title=Rs2233678"},{"properties":{"is_associated_with_disease":"Breast cancer","type":{"mTextform":"Is a snp","mUrlform":"Is_a_snp","mDbkeyform":"Is_a_snp","mUserCaseDBKey":"Is_a_snp","mNamespace":14,"mInterwiki":"","mFragment":"","mArticleID":-1,"mLatestID":false,"mRestrictions":[],"mOldRestrictions":false,"mCascadeRestriction":null,"mCascadingRestrictions":null,"mRestrictionsExpiry":[],"mHasCascadingRestrictions":null,"mCascadeSources":null,"mRestrictionsLoaded":false,"mPrefixedText":"Category:Is a snp","mTitleProtection":null,"mDefaultNamespace":0,"mWatched":null,"mLength":-1,"mRedirect":null,"mNotificationTimestamp":[],"mBacklinkCache":null}},"title":{"mTextform":"Rs2233679","mUrlform":"Rs2233679","mDbkeyform":"Rs2233679","mUserCaseDBKey":"Rs2233679","mNamespace":0,"mInterwiki":"","mFragment":"","mArticleID":-1,"mLatestID":false,"mRestrictions":[],"mOldRestrictions":false,"mCascadeRestriction":null,"mCascadingRestrictions":null,"mRestrictionsExpiry":[],"mHasCascadingRestrictions":null,"mCascadeSources":null,"mRestrictionsLoaded":false,"mPrefixedText":null,"mTitleProtection":null,"mDefaultNamespace":0,"mWatched":null,"mLength":-1,"mRedirect":null,"mNotificationTimestamp":[],"mBacklinkCache":null},"uri":"http:\/\/genewikiplus.org\/index.php?title=Rs2233679"},{"properties":{"is_associated_with_disease":"Breast cancer","type":{"mTextform":"Is a snp","mUrlform":"Is_a_snp","mDbkeyform":"Is_a_snp","mUserCaseDBKey":"Is_a_snp","mNamespace":14,"mInterwiki":"","mFragment":"","mArticleID":-1,"mLatestID":false,"mRestrictions":[],"mOldRestrictions":false,"mCascadeRestriction":null,"mCascadingRestrictions":null,"mRestrictionsExpiry":[],"mHasCascadingRestrictions":null,"mCascadeSources":null,"mRestrictionsLoaded":false,"mPrefixedText":"Category:Is a snp","mTitleProtection":null,"mDefaultNamespace":0,"mWatched":null,"mLength":-1,"mRedirect":null,"mNotificationTimestamp":[],"mBacklinkCache":null}},"title":{"mTextform":"Rs2233682","mUrlform":"Rs2233682","mDbkeyform":"Rs2233682","mUserCaseDBKey":"Rs2233682","mNamespace":0,"mInterwiki":"","mFragment":"","mArticleID":-1,"mLatestID":false,"mRestrictions":[],"mOldRestrictions":false,"mCascadeRestriction":null,"mCascadingRestrictions":null,"mRestrictionsExpiry":[],"mHasCascadingRestrictions":null,"mCascadeSources":null,"mRestrictionsLoaded":false,"mPrefixedText":null,"mTitleProtection":null,"mDefaultNamespace":0,"mWatched":null,"mLength":-1,"mRedirect":null,"mNotificationTimestamp":[],"mBacklinkCache":null},"uri":"http:\/\/genewikiplus.org\/index.php?title=Rs2233682"}]},"result":"Success"}};
	var data_brca2={"ask":{"query":{"q":"[[BRCA2]]","po":["is associated with disease"]},"results":{"count":1,"items":[{"properties":{"is_associated_with_disease":["Hereditary breast ovarian cancer","Hypersensitivity reaction type I disease","Female breast cancer","Brain cancer","Pancreatic cancer","Ovarian cancer","Anemia","Syndrome","Leukemia","Prostate cancer","Melanoma"],"type":{"mTextform":"All articles with dead external links","mUrlform":"All_articles_with_dead_external_links","mDbkeyform":"All_articles_with_dead_external_links","mUserCaseDBKey":"All_articles_with_dead_external_links","mNamespace":14,"mInterwiki":"","mFragment":"","mArticleID":-1,"mLatestID":false,"mRestrictions":[],"mOldRestrictions":false,"mCascadeRestriction":null,"mCascadingRestrictions":null,"mRestrictionsExpiry":[],"mHasCascadingRestrictions":null,"mCascadeSources":null,"mRestrictionsLoaded":false,"mPrefixedText":"Category:All articles with dead external links","mTitleProtection":null,"mDefaultNamespace":0,"mWatched":null,"mLength":-1,"mRedirect":null,"mNotificationTimestamp":[],"mBacklinkCache":null}},"title":{"mTextform":"BRCA2","mUrlform":"BRCA2","mDbkeyform":"BRCA2","mUserCaseDBKey":"BRCA2","mNamespace":0,"mInterwiki":"","mFragment":"","mArticleID":-1,"mLatestID":false,"mRestrictions":[],"mOldRestrictions":false,"mCascadeRestriction":null,"mCascadingRestrictions":null,"mRestrictionsExpiry":[],"mHasCascadingRestrictions":null,"mCascadeSources":null,"mRestrictionsLoaded":false,"mPrefixedText":null,"mTitleProtection":null,"mDefaultNamespace":0,"mWatched":null,"mLength":-1,"mRedirect":null,"mNotificationTimestamp":[],"mBacklinkCache":null},"uri":"http:\/\/genewikiplus.org\/index.php?title=BRCA2"}]},"result":"Success"}};
	var data=data_brca2;
	//$.getJSON("http://genewikiplus.org/api.php?action=ask&q=[[Category:Human_proteins]][[is_associated_with::"+disease_query+"]]&po=HasSNP&format=json&callback=?", function(data) {
		//draw_disease_network(data);
	//});
	draw_gene_disease_network(data);
	function draw_gene_disease_network(data)
	{
			var div_id = "networkview";
                var network_json = {
                        dataSchema: {
                    		nodes: [ { name: "label", type: "string" },
                    		{ name: "type", type: "string" },{ name: "category", type: "string" }                   		      
           		         	],
							edges: [ { name: "label", type: "string" }						         
							]
                    	},
                        data: {
                            nodes: [ { id: "1", label: "1" },
                                     { id: "2", label: "2" }
                            ],
                            edges: [ { id: "2to1", target: "1", source: "2", label: "2 to 1" }
                            ]
                        }
                };
                
                var visual_style = {
                    global: {
                        backgroundColor: "#ABCFD6"
                    },
                    nodes: {
                        shape: "RECTANGLE",
                        borderWidth: 3,
                        borderColor: "#ffffff",
                        size: "auto"
                       }
                     };
  
                network_json["data"]["nodes"]=[];
                network_json["data"]["edges"]=[];
                var counter=1;
                var edgecounter=1;
         
                network_json["data"]["nodes"].push({id:String(counter),label:data["ask"]["query"]["q"],type:"q"});
                counter++;
                var secondary_centre;
                secondary_centre=counter-1;
                
                if(data["ask"]["results"]["items"][0]["properties"]["is_associated_with_disease"] instanceof Array)
					{
					
	            	for(var temp_disease in data["ask"]["results"]["items"][0]["properties"]["is_associated_with_disease"])
                	{
                	network_json["data"]["nodes"].push({id:String(counter),label:data["ask"]["results"]["items"][0]["properties"]["is_associated_with_disease"][temp_disease],type:"disease"});
                	network_json["data"]["edges"].push({id:String(edgecounter),target:String(counter),source:String(secondary_centre)});
                	edgecounter++;
                	counter++;	
                	}
					}
					else
					{
	            	network_json["data"]["nodes"].push({id:String(counter),label:data["ask"]["results"]["items"][0]["properties"]["is_associated_with_disease"],type:"disease"});
                	network_json["data"]["edges"].push({id:String(edgecounter),target:String(counter),source:String(secondary_centre)});
                	edgecounter++;
                	counter++;	
    
					}
                	
                
                     var layout = {
  								  name:    "Radial",
    							  options: { radius:"150" }
									};              
                var options = {
                    swfPath: "swf/CytoscapeWeb",
                    flashInstallerPath: "swf/playerProductInstall"
                };
                
                 var counter_per_node=0;
                var counter_for_deletion=0;
                var repeated_node="";
                var unique_node="";
                for(var temp_node in network_json["data"]["nodes"])
                {
                	counter_per_node=0;
                	for(var temp_node2 in network_json["data"]["nodes"])
                	{
                		
                		if(network_json["data"]["nodes"][temp_node]["label"]==network_json["data"]["nodes"][temp_node2]["label"])
                		{
                			counter_per_node++;
                		}
                	}
                	counter_for_deletion=0;
                	
                	if(counter_per_node>1)
                	{
                		
                		repeated_node=network_json["data"]["nodes"][temp_node]["id"];
                		
                		for(var delete_temp in network_json["data"]["nodes"])
                		{
                			
                			if(typeof network_json["data"]["nodes"][delete_temp]["id"] === "undefined")
                			{
                				
                			}	
                			else
                			{                			
                			if(network_json["data"]["nodes"][delete_temp]["label"]==network_json["data"]["nodes"][temp_node]["label"])
                			{
                			counter_for_deletion++;	                			
                			if(counter_for_deletion>1)
                			{
                				//delete [delete_temp]["label"]="To be deleted";
                				for(var delete_edge in network_json["data"]["edges"])
                				{            					
                					if(network_json["data"]["nodes"][delete_temp]["id"]==network_json["data"]["edges"][delete_edge]["target"])
                					{
                						network_json["data"]["edges"][delete_edge]["target"]=repeated_node;
                					}
                				}
                				network_json["data"]["nodes"].splice(delete_temp, 1);	                				
                			}
                			
                			}
                			}	
                		}
                		
                	}
                	
                }
                var all_categories_array=[];
                var ajax_nodeids=new Array;
                var ajax_nodelabels=new Array;
                var ajax_nodelabels_count=0;
                var ajax_nodecount=-1;
                var disease_count=0;
                var data_storage=[];
                var data_storage_count=-1;
                inner_label_count=0;
                for(var temp in network_json["data"]["nodes"])
                {
                	if(network_json["data"]["nodes"][temp]["type"]=="disease")
                	{
                		disease_count++;
                	}
                }
                for(var temp in network_json["data"]["nodes"])
                {
                	
                	if(network_json["data"]["nodes"][temp]["type"]=="disease")
                	{
                		ajax_nodeids.push(network_json["data"]["nodes"][temp]["id"]);
                		ajax_nodelabels.push(network_json["data"]["nodes"][temp]["label"]);
                		ajax_nodelabels_count++;
                	
                		alert(ajax_nodelabels[ajax_nodelabels_count]);
                		<!---------Buggy because of multiple Ajax requests. --!>
                		$.getJSON("http://genewikiplus.org/api.php?action=query&titles="+ajax_nodelabels[ajax_nodelabels_count-1].replace(" ","+")+"&prop=categories&format=json&callback=?", function(data) {
							data_storage.push(data);
							
									ajax_nodecount++;
									data_storage_count++;							
								$("#content").append("Node count:"+ajax_nodelabels_count+"<br />"+data_storage_count+"<br />");
							$("#content").append("Title: "+ajax_nodelabels[inner_label_count]+"<br />");
							for(var temp3 in data_storage[data_storage_count]["query"]["pages"])
							{
							for(var temp2 in data_storage[data_storage_count]["query"]["pages"][temp3]["categories"])
							{
								if((data_storage[data_storage_count]["query"]["pages"][temp3]["categories"][temp2]["title"].indexOf("articles")==-1)&&(data_storage[data_storage_count]["query"]["pages"][temp3]["categories"][temp2]["title"].indexOf("Articles")==-1)&&(data_storage[data_storage_count]["query"]["pages"][temp3]["categories"][temp2]["title"].indexOf("Wikipedia")==-1)&&(data_storage[data_storage_count]["query"]["pages"][temp3]["categories"][temp2]["title"].indexOf("Pages")==-1)&&(data_storage[data_storage_count]["query"]["pages"][temp3]["categories"][temp2]["title"].indexOf("pages")==-1)&&(data_storage[data_storage_count]["query"]["pages"][temp3]["categories"][temp2]["title"].indexOf("2010")==-1))
								{
								all_categories_array.push({"category":data_storage[data_storage_count]["query"]["pages"][temp3]["categories"][temp2]["title"],"node_disease_id":ajax_nodeids[ajax_nodecount],"node_disease_label":ajax_nodelabels[inner_label_count]});
								$("#content").append("category"+":"+data_storage[data_storage_count]["query"]["pages"][temp3]["categories"][temp2]["title"]+","+"node_disease_id"+":"+ajax_nodeids[ajax_nodecount]+","+"node_disease_label"+":"+ajax_nodelabels[inner_label_count]+"<br />");								
								$("#content").append("<br /><br />--------"+ajax_nodecount+"<br /><br />--------");
								}
							}
							}
							if(ajax_nodecount==disease_count-1)
							{
								alert("Hey!")
								//$("#content").html("");
								for(var temp2 in ajax_nodeids)
								{
//									$("#content").append(ajax_nodeids[temp2]+" "+ajax_nodelabels[temp2]+"<br />");
								}
								
								//$("#content").append("<br />");
							for(var temp in all_categories_array)
								{
							//$("#content").append("category"+":"+all_categories_array[temp]["category"]+","+"node_disease_id"+":"+all_categories_array[temp]["node_disease_id"]+","+"node_disease_label"+":"+all_categories_array[temp]["node_disease_label"]+"<br /><br />-----<br />");		
								}
								group_nodecategories();
							}
						inner_label_count++;
						});
                	}
                }
                var group_category=[];
                
                function group_nodecategories()
                {
                var groupno=0;
                var group_flag=0;
                var group_category_index=0;
                //$("#content").ht0ml("");
                for(var temp in all_categories_array)
                {
                	group_flag=0;
                	count_check=0;
                	for(var group_temp in group_category)
                	{
                		//$("#content").append(group_category[group_temp]["group_category"]+" "+all_categories_array[temp]["category"]);
                		if(group_category[group_temp]["group_category"]==all_categories_array[temp]["category"])
                		{
                			//$("#content").append("<br />group_flag=1<br />");
                			group_flag=1;
                			group_category_index=group_temp;
                		}
                	}
                		
                	if(group_flag==0)
                	{
                		//$("#content").append("<br />group_flag=0<br />");
                		//$("#content").append("<br />"+all_categories_array[temp]["category"]+"<br />");
                	group_category.push({"group_no":groupno,"group_category":all_categories_array[temp]["category"],"ids":[]});
                	groupno++;
                	
                	for(var temp2 in all_categories_array)
					{
						
						if((all_categories_array[temp2]["category"]==all_categories_array[temp]["category"]))
						{
							//$("#content").append((all_categories_array[temp2]["category"]+" "+all_categories_array[temp]["category"]));
							//$("#content").append("<br />"+all_categories_array[temp2]["node_disease_label"]+"<br />");
								group_category[group_category.length-1]["ids"].push(all_categories_array[temp2]["node_disease_id"]);
								//alert(all_categories_array[temp2]["node_disease_label"]+" "+all_categories_array[temp]["category"]);								
						}
					}
					}
					/*for(var test in network_json["data"]["nodes"])
					{
						for(var test2 in group_category[group_category.length-1]["ids"])
						{
						if(group_category[group_category.length-1]["ids"][test2]==network_json["data"]["nodes"][test]["id"])
						{
							//alert(network_json["data"]["nodes"][test]["label"]);
							group_category[group_category.length-1]["ids"].push(all_categories_array[temp2]["node_disease_id"]);	
						}
						}
						
					}*/
                	
                }
                var to_filter=[];
                var filter_flag=0;
                var count_category=0;
                //To see group array
                //$("#content").html("");
                for(var temp in group_category)
                {
                	
                //$("#content").append(group_category[temp]["group_category"]);
              //$("#content").append(group_category[temp]["ids"].length+"<br />");
                	
                }
                
                for(var temp_main in network_json["data"]["nodes"])
                {
                	filter_flag=0;
                	count_category=0;
                	for(var temp in group_category)
                {
                	
                	for(var temp2 in group_category[temp]["ids"])
                	{
                		if(group_category[temp]["ids"][temp2]==network_json["data"]["nodes"][temp_main]["id"])
                		{
                			
                			filter_flag=1;
                			if(count_category==1)
                			{
                			network_json["data"]["nodes"].push({id:String(counter),label:group_category[temp]["group_category"],type:"category"});
                			to_filter.push(String(counter));
                			network_json["data"]["edges"].push({id:String(edgecounter),source:network_json["data"]["nodes"][temp_main]["id"],target:String(counter)});
                			edgecounter++;
                			counter++;
                				
                			}
                		count_category++;
                			
                		}	
                			
                	}
                }
                if(filter_flag==0)
                {
                	to_filter.push(network_json["data"]["nodes"][temp_main]["id"]);
                	//alert(to_filter[to_filter.length-1]);
                }
                }
                
                var vis = new org.cytoscapeweb.Visualization(div_id, options);
                global_vis=vis;
                vis.draw({ network: network_json, visualStyle: visual_style, layout:layout });	
                vis.ready(function(){
		//vis.filter("nodes",to_filter);
	});
                }
                
                
	}
	
});
	